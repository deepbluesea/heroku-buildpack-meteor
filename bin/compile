#!/bin/sh

BUILD_DIR=/usr/local/bin:$BUILD_DIR
CACHE_DIR=$2
METEOR_HOME=$BUILD_DIR/.meteor/checkout:$METEOR_HOME
echo $BUILD_DIR
install_meteor() {
cd /usr/local/bin
mkdir -p ~/nodes && cd ~/nodes
echo "Installing nodejs"
curl -O http://nodejs.org/dist/v0.10.13/node-v0.10.13-linux-x64.tar.gz
tar -xzf node-v0.10.13-linux-x64.tar.gz
mv node-v0.10.13-linux-x64 0.10.13
ln -s 0.10.13 current
  cd /usr/local/bin
mkdir -p ~/meteor && cd ~/meteor
	git clone git://github.com/meteor/meteor.git
	cd meteor && zip -r ../../meteor.zip .
}

[ ! -d meteor ] && mkdir meteor
[ ! -d $CACHE_DIR ] && mkdir $CACHE_DIR

install_meteor

echo "Checking for post_compile script"
if [ -f $BUILD_DIR/bin/post_compile ] ; then
    echo "-----> Running post_compile hook"
    chmod +x $BUILD_DIR/bin/post_compile
    $BUILD_DIR/bin/post_compile
fi
